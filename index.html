<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trigger GitHub Workflow and Display Status</title>
</head>
<body>

  <h2>Trigger GitHub Workflow</h2>
  <label for="token">Enter GitHub Token:</label>
  <input type="password" id="token" placeholder="Your GitHub Token">
  <button onclick="triggerWorkflow()">Run Workflow</button>
  <p id="status">Workflow Status: Not Started</p>

  <script>
    async function triggerWorkflow() {
      const token = document.getElementById('token').value;
      
      if (!token) {
        alert('Please enter your GitHub token');
        return;
      }

      const triggerResponse = await fetch('https://api.github.com/repos/omadridi858/page-action/actions/workflows/triggered-workflow.yml/dispatches', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          ref: 'main'  // Replace 'main' with your branch name, if different
        })
      });

      if (triggerResponse.ok) {
        document.getElementById('status').textContent = 'Workflow Status: Triggered';
        await checkWorkflowStatus(token);
      } else {
        alert('Failed to trigger workflow.');
        console.error('Error:', await triggerResponse.json());
      }
    }

    async function checkWorkflowStatus(token) {
      try {
        // Poll every 5 seconds to check the workflow status
        const interval = setInterval(async () => {
          const response = await fetch('https://api.github.com/repos/omadridi858/page-action/actions/runs', {
            headers: {
              'Authorization': `Bearer ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const latestRun = data.workflow_runs[0];  // Get the latest run
document.getElementById('status').textContent = ``;
            // Update the status text
            document.getElementById('status').textContent += `Workflow Status: ${latestRun.status}, Conclusion: ${latestRun.conclusion || 'In Progress'}`;

            // Stop polling if the workflow is complete
            if (latestRun.status === 'completed') {
              clearInterval(interval);
            }
          } else {
            console.error('Error fetching workflow status:', await response.json());
          }
        }, 5000); // Poll every 5 seconds
      } catch (error) {
        console.error('Error:', error);
      }
    }
  </script>

</body>
</html>
